<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus produtos</title>
    <link rel="shortcut icon" href="./assets/icons/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="ProdutoStyle.css">
</head>
<body>
    <header class="header">
        <div>
            <img src="/src/assets/images/logo.png" alt="Logo verde médio">
        </div>
        <div class="section">
            <h1>Cotações</h1>
        </div>
        <div class="icons">
            <img src="/src/assets/icons/Frame 879.png" alt="notificação e ajuda">
        </div>
    </header>

    <main>
        <section id="produtos">
            <input type="text" id="campoBusca" placeholder="Busque pelo ID ou nome da cotação">
            <button onclick="buscarProduto()">Buscar</button>
        </section>

        <div id="resultado"></div>

        <script>
            const apiUrl = 'http://localhost:8080/api/produtos/listar';

            async function buscarProduto() {
                const busca = document.getElementById('campoBusca').value.toLowerCase();
                const resultadoDiv = document.getElementById('resultado');
                resultadoDiv.innerHTML = 'Carregando...';
                
                try {
                    const response = await fetch(apiUrl);
                    const produtos = await response.json();
                    const resultados = produtos.filter(produto =>
                        produto.id.toString().includes(busca) || produto.nome.toLowerCase().includes(busca)
                    );

                    resultadoDiv.innerHTML = '';

                    if (resultados.length > 0) {
                        resultados.forEach(produto => {
                            const produtoDiv = document.createElement('div');
                            produtoDiv.classList.add('produto');
                            produtoDiv.innerHTML = `
                                <strong>${produto.nome}</strong> (ID: ${produto.id})<br>
                                Descrição: ${produto.descricao}`;
                            resultadoDiv.appendChild(produtoDiv);
                        });
                    } else {
                        resultadoDiv.innerHTML = 'Nenhum produto encontrado.';
                    }

                } catch (error) {
                    resultadoDiv.innerHTML = 'Erro ao carregar os produtos. Tente novamente mais tarde.';
                    console.error(error);
                }
            }
        </script>

        <section class="Listagem" id="lista-produtos">
            <ul id="lista-produtos"></ul>
        </section>

        <script>
            async function fetchProdutos() {
                try {
                    const response = await fetch('http://localhost:8080/api/produtos/listar');
                    if (!response.ok) {
                        throw new Error('Erro na rede: ' + response.status);
                    }
                    const produtos = await response.json();
                    const lista = document.getElementById('lista-produtos');
                    lista.innerHTML = ''; 
                    produtos.forEach(produto => { 
                        const li = document.createElement('li');
                        li.textContent = `${produto.nome} - ${produto.descricao}`;
                        lista.appendChild(li);
                    });
                } catch (error) {
                    console.error('Erro ao buscar produtos:', error);
                    alert('Erro ao carregar produtos. Tente novamente mais tarde.'); 
                }
                console.log("Produtos carregados");
            }

            document.addEventListener('DOMContentLoaded', fetchProdutos); 
        </script>
    </main>
</body>
</html>
